<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Nyx Chat</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="container">
    <header>
      <h1>ðŸŒ‘ Nyx Chat</h1>
      <p>Private conversations, no strings attached.</p>
    </header>

    <section class="server-controls">
      <input id="serverIdInput" placeholder="Enter or create server ID" />
      <button id="createBtn">Create Server</button>
      <button id="joinBtn">Join Server</button>
    </section>

    <section class="chat-box" id="chatBox"></section>

    <section class="message-controls">
      <input id="messageInput" placeholder="Type a message..." />
      <button id="sendBtn">Send</button>
    </section>
  </div>

  <script>
    let socket = null;
    let serverId = "";
    const chatBox = document.getElementById("chatBox");

    document.getElementById("createBtn").onclick = async () => {
      const res = await fetch("http://localhost:8080/api/nyx-servers", {
        method: "POST",
        headers: {
          Authorization: "Bearer YOUR_JWT_TOKEN_HERE",
        },
      });
      const data = await res.json();
      serverId = data.server_id;
      document.getElementById("serverIdInput").value = serverId;
      alert("Server created!");
    };

    document.getElementById("joinBtn").onclick = () => {
      serverId = document.getElementById("serverIdInput").value;
      if (!serverId) return alert("Please enter a server ID.");
      socket = new WebSocket(`ws://localhost:8080/api/nyx-servers/join?server_id=${serverId}`);

      socket.onopen = () => {
        appendMessage("ðŸŸ¢ Connected to server.");
      };

      socket.onmessage = (event) => {
        const msg = JSON.parse(event.data);
        appendMessage(`${msg.sender_id}: ${msg.content}`);
      };

      socket.onclose = () => {
        appendMessage("ðŸ”´ Disconnected.");
      };
    };

    document.getElementById("sendBtn").onclick = () => {
      const msgInput = document.getElementById("messageInput");
      const content = msgInput.value.trim();
      if (!content || !socket) return;

      const msg = {
        sender_id: "html-client",
        content,
        server_id: serverId,
        timestamp: new Date().toISOString(),
      };

      socket.send(JSON.stringify(msg));
      msgInput.value = "";
    };

    function appendMessage(text) {
      const div = document.createElement("div");
      div.textContent = text;
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    }
  </script>
</body>
</html>
